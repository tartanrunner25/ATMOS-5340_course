
<img src='./images/class_logo.png' width=500px align='right' style='padding-left:30px'>

**Week of October 5th, 2020**<br>  
**ATMOS 5340: Environmental Programming and Statistics**<br>
**John Horel and Derek Mallia**<br>
<br>

> # Announcement: 
> Your 4th programming assignement on Module 5 is **due this Sunday.**

> # Today's Objective<br>
> Opening/closing basic text files with Python<br>
> Reading in data and information from text and csv formatted files<br>
> Writing out text and csv-formatted files<br>
> Working with path and file names
<br><br>


#  Python File I/O
## Chapter 6 from the Alex DeCaria textbook: 'File I/O'

The Environmental Sciences are considered to be 'data' intensive as there are a number of different sources such as model output or observations. Sometimes this data types are in non-compressed file formats such as text or csv-formatted files. Sometimes data is stored in a compressed file format such as Hierarchical Data Format version 5 (HDF5) or Network Common Data Form (netCDF). This lecture will primarily focus on basic file formats (i.e non-compressed files).  
- Here will focus on opening and closing files
- Reading in and outputting data in a text-like format
- Listing files with the os.path module

**Before starting:** Make sure that you open up a Jupyter notebook session using OnDemand so you can interactively follow along with today's lecture! 

<br><br>
---
---

# Opening and closing files

**Opening files:** Files can be simply opened using Python's `open()` function, which uses the following syntax:

    my_file = 'file.txt'
    
    f = open(my_file, <mode here>)
    

The arguments for our function include the file name, which we want to read in (this should be a 'string'), and an argument for mode that refers to how we want to open up our file. The variable `f` will contain a reference to the resulting file object. Listed below are the available modes for accessing a file:

>- `r`: Text file is opened as read only
>- `w`: Text file is open as write only. Any new output will overwrite the exist file.
>- `r+` or `w+`: Text file is opened for reading and writing. Any new output will overwrite the exist file.
>- `a`: Text file is opened for writing in an appended mode. Any new changes to the file will be appended at the end.
>- `b`: This tell Python to open the file as a binary file. For exampe, `rb` indicates a read-only binary file, and `rb+` would indicate a read and write enabled binary. This is usually needed when opening csv files with the csv module. More on this later...

**Closing files:** A file will be closed using the `close()` method. This can be accomplished by *appending* the method to the file object.

    f.close()
    
If you are lazy, you can use Python's `with` construct to access the file, and do whatever with the contents of the file using the following shorthand syntax:

    with open(my_file, <mode here>) as f:
        [Do stuff to file in this Python code block]
        



<br><br>
---
---

# Reading in text from files

Similar to before, we will use the `open` statement to access data within a text file. First, open up a CHPC OnDemand linux terminal, and
copy the following file into your Atmos 5340 directory. Feel free to make a subdirectory for Module_6!

    mkdir Module_6
    cp /uufs/chpc.utah.edu/common/home/u0703457/public_html/dereks_homepage/Atmos_5340/class_files/module6_datafile1.txt Module_6/

‚ö†Ô∏è‚ö†Ô∏è Even though we have not used linux in a few weeks, what we learned earlier in this semester will become increasingly helpful, especially as we get closer to the end of the semester. So keep those linux skills sharp üî™üî™

Lets open up the `module6_datafile1.txt` text file that we copied over into our working directory....

    f = open('module6_datafile1.txt','r')
    
now, lets use Python's `readline()` method to output the lines within our text file... 

    f.readline()
    >> "Today's weather forecast for Salt Lake City is:\n"
    
    f.readline()
    >> 'Sunny, with a high near 91. \n'
    
    f.readline()
    'Southwest wind around 10 mph \n'
    
    f.readline()
    'Winds becoming west northwest later in the day.'
    

‚ö†Ô∏è‚ö†Ô∏è Note that parts of section 6.3 from the DeCaria textbook is slightly outdated, as the `next` method became depreciated in Python versions newer than 3.3. `readline()` has replaced `next`. ‚ö†Ô∏è‚ö†Ô∏è
<br> <br>

We can also employ what we learned from the last lecture, and use a Python's `for` loop construct to read in each line of our text file!

    f = open("module6_datafile1.txt", "r")
    for x in f:
        print(x)

    f.close()      #Lets make sure sure that we close our file!
    
    
    >> Today's weather forecast for Salt Lake City is:
    >> Sunny, with a high near 91. 
    >> Southwest wind around 10 mph 
    >> Winds becoming west northwest later in the day.

<br>
If you want, you can also read in the entire file as a list...

    with open("module6_datafile1.txt", "r") as f:
        data = f.readlines()
    
    print(data)

    >> ["Today's weather forecast for Salt Lake City is:\n", 'Sunny, with a high near 91. \n', 'Southwest wind around 10 mph \n', 'Winds becoming west northwest later in the day.']
    
   
<br><br>
---
---

# Writing text to a file

File objects also have the `write` method, which write a single string to a text file. Lets make a copy of our `module6_datafile1.txt` file in linux and call it `module6_datafile2.txt`. ‚ö†Ô∏è‚ö†Ô∏è Do you remember how to do this? ‚ö†Ô∏è‚ö†Ô∏è 

Next, lets append the following strings to our text file. 

    with open("module6_datafile2.txt", "a") as f:
        f.write('Tomorrow: A slight chance of showers before 11am.\n')
        f.write('Then a slight chance of showers and thunderstorms after noon.\n')
        f.write('Mostly sunny, with a high near 81. Calm wind.\n')
        f.write('Chance of precipitation is 20%.\n')
        
Lets go back to our linux terminal and examine our file. How do we do this again? Do we notice anything different about our `module6_datafile2.txt` file?
    
    
    /uufs/chpc.utah.edu/common/home/u0703457/public_html/dereks_homepage/Atmos_5340/class_files/module6_datafile3.txt
    
    
Next, lets go back to our Jupyter Notebook session and activate Python's csv module and open our csv file:

    import csv 
    
    f = open("module6_datafile3.txt","r")
    
‚ö†Ô∏è‚ö†Ô∏è Sometimes, we use `rb` for the mode argument, since openig a file with the csv module can yield weird results when a file it **NOT** opened in binary mode. I am feeling particurly risky today, so for now we will just open our simple csv file using the `r` mode. 

    r = csv.reader(f,delimiter = ',')
    
Here, we assume that our values in our text file are seperated with the `,` delimiter. We can confirm this by just look at the contents of our file in our linux terminal. You may need to confirm this each time when working with different files, as different people/institutions will format their csv files in different ways. Anyways, since our values are indeed seperated with a `,`, we set our delimiter argument as `,`.


As a next step, lets open our csv file, read in each line, and seperate our values based on the `,` delimiter, skip our header, and save each line to our data variable called `data`:

    import csv 
    with open("module6_datafile3.txt","rb")
        r = csv.reader(f,delimiter = ',')
        for i, data in enumerate(r):
            if i == 0:
                pass
            else:
                print(data)
                
This simple code is a nice example of the many concepts that we've learned in this class so far!




    

<br><br>
---
---

# Reading and write Delimited files

Using Python's csv module, we can read in data seperated by commas, colons, white spaces, or some other delimiter. Spread sheet programs like Microsoft excel often use csv files, so this is a pretty common format to see data in! Luckly for us, Python has an easy way of working with csv files.

Before we try this out, copy the following file to your working directory:




    

> # Want more practice!?<br>
> Check out the following webpages:<br>
> http://www.johnny-lin.com/pyintro/ed01/free_pdfs/ch05.pdf<br>
> https://www.tutorialspoint.com/python3/python_files_io.htm<br>
> https://www.w3schools.com/python/python_file_handling.asp<br>
> https://www.w3schools.com/python/python_file_write.asp<br>
> https://www.w3schools.com/python/python_file_remove.asp<br>



